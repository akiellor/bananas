#!/usr/bin/env node

var requireLib = function(name) {
  return require(__dirname + '/../lib/' + name);
}

var Immutable = require('immutable');
var transitions = Immutable.fromJS(require(require('path').resolve(process.argv[2])));
var states = requireLib('states');

var graphviz = require('graphviz');
var g = graphviz.digraph("G");

function sanitize(string) {
  return string.replace(/([:{} "\[\]])/g, '\\$1');
}

states(transitions).forEach(function(value, model) {
  var n1 = g.addNode(sanitize(model.toString()));
  value.forEach(function(edgeName, otherModel) {
    var n2 = g.addNode(sanitize(otherModel.toString()));
    g.addEdge(n2, n1)
      .set('label', edgeName);
  });
});

console.log(g.to_dot());
