#!/usr/bin/env node

var path = require('path');
var transitions = require(path.join(process.cwd(), process.argv[2]));
var buildGraph = require(__dirname + '/../lib/build_graph.js');
var traverse = require(__dirname + '/../lib/traverse.js');
var graph = buildGraph(transitions);

var graphviz = require('graphviz');

var g = graphviz.digraph('system');

traverse(graph, function(node) {
  g.addNode(node.name);
  (node.children || []).forEach(function(child) {
    g.addNode(child.name);
    g.addEdge(node.name, child.name);
  });
});

console.log(g.to_dot());
